<!DOCTYPE HTML>
<html>
<head>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    <title>Multi-Snake: Lobby</title>
    <style>
        canvas{
            border: 1px solid black;
            margin-right: auto;
            margin-left: auto;
            display: block;
        }
        h1{
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Multi-Snake!</h1>
    <canvas id="game-canvas" height="500" width="500"></canvas>
    <script>
        var socket = io();
        var host = false;
        var gameStarted = false;
        var playerNum = -1;
        var playerList = [];
        var segments = [];
        var canvas = document.getElementById("game-canvas");
        var ctx = canvas.getContext("2d");
        socket.on('host', function(){
            host = true;
        });
        socket.on('player', function(e){
            playerNum = e;
        });
        socket.on('playerList', function(e){
            playerList = e;
            renderPlayers();
        });
        $('body').on('keydown', function(e){
            if(playerNum < 4 && playerNum >= 0 && e.keyCode >= 37 && e.keyCode <= 40) {
                socket.emit('key', {
                    code: e.keyCode,
                    player: playerNum
                });
            }
        });

        //functions
        function renderPlayers(){
            for(var i in playerList){
                ctx.fillStyle = playerList[i].color;
                ctx.fillRect(playerList[i].pos.x*10,playerList[i].pos.y*10,10,10);
            }
        }
        function addToSegmentList(){
            if(host) {
                for (var i in playerList) {
                    segments.push({
                        pos: {
                            x: playerList[i].pos.x,
                            y: playerList[i].pos.y
                        },
                        dies: playerList[i].len
                    });
                }
            }
            else{
                alert('Nice try, buddy.');
            }
        }
        function expireSegments(){
            if(host){
                for(var i in segments){
                    segments[i].dies--;
                    if(segments[i].dies <= 0){
                        ctx.fillStyle = 'white';
                        ctx.fillRect(segments[i].pos.x*10,segments[i].pos.y*10,10,10);
                        segments.splice(i,1);
                    }
                }
            }
            else{
                alert('Nice try, buddy.');
            }
        }
    </script>
</body>
</html>